<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Table Toggle Test</title>
  <style>
    .hidden { display: none; }
    table { border-collapse: collapse; width: 100%; }
    td, th { border: 1px solid #ddd; padding: 8px; }
  </style>
</head>
<body>
  <h2>Test Table (10 items)</h2>
  <table id="test-table">
    <thead>
      <tr>
        <th>평균</th>
        <th>항목</th>
        <th>설명</th>
      </tr>
    </thead>
    <tbody>
      <!-- 처음 5개 행: data-expandable-row 없음 -->
      <tr>
        <td>4.5</td>
        <td>항목 1</td>
        <td>설명 1</td>
      </tr>
      <tr>
        <td>4.4</td>
        <td>항목 2</td>
        <td>설명 2</td>
      </tr>
      <tr>
        <td>4.3</td>
        <td>항목 3</td>
        <td>설명 3</td>
      </tr>
      <tr>
        <td>4.2</td>
        <td>항목 4</td>
        <td>설명 4</td>
      </tr>
      <tr>
        <td>4.1</td>
        <td>항목 5</td>
        <td>설명 5</td>
      </tr>
      <!-- 6번째부터: data-expandable-row 있음 + hidden -->
      <tr class="hidden" data-expandable-row>
        <td>4.0</td>
        <td>항목 6</td>
        <td>설명 6</td>
      </tr>
      <tr class="hidden" data-expandable-row>
        <td>3.9</td>
        <td>항목 7</td>
        <td>설명 7</td>
      </tr>
      <tr class="hidden" data-expandable-row>
        <td>3.8</td>
        <td>항목 8</td>
        <td>설명 8</td>
      </tr>
      <tr class="hidden" data-expandable-row>
        <td>3.7</td>
        <td>항목 9</td>
        <td>설명 9</td>
      </tr>
      <tr class="hidden" data-expandable-row>
        <td>3.6</td>
        <td>항목 10</td>
        <td>설명 10</td>
      </tr>
    </tbody>
  </table>

  <div style="margin-top: 20px; text-align: center;">
    <button onclick="toggleExpandTable('test-table')" id="test-table-toggle">
      <span id="test-table-text">전체보기 (10개 항목)</span>
      <span id="test-table-icon">▼</span>
    </button>
  </div>

  <script>
    function toggleExpandTable(tableId) {
      const table = document.getElementById(tableId);
      const toggleText = document.getElementById(tableId + '-text');
      const toggleIcon = document.getElementById(tableId + '-icon');
      if (!table) return;
      
      // data-expandable-row 속성을 가진 행들만 선택 (5개 이후의 행들)
      const expandableRows = table.querySelectorAll('tr[data-expandable-row]');
      if (expandableRows.length === 0) return; // 5개 이하면 토글 필요 없음
      
      const hiddenRows = table.querySelectorAll('tr[data-expandable-row].hidden');
      const isExpanded = hiddenRows.length === 0;
      
      // 전체 행 수 계산 (5개 고정 + expandable 행들)
      const totalCount = 5 + expandableRows.length;
      
      console.log('Toggle clicked');
      console.log('Expandable rows:', expandableRows.length);
      console.log('Hidden rows:', hiddenRows.length);
      console.log('Is expanded:', isExpanded);
      
      if (isExpanded) {
        // 접기 - expandable 행들만 숨기기
        expandableRows.forEach(row => {
          row.classList.add('hidden');
        });
        // 버튼 상태 업데이트
        if (toggleText) {
          toggleText.textContent = '전체보기 (' + totalCount + '개 항목)';
        }
        if (toggleIcon) {
          toggleIcon.textContent = '▼';
        }
      } else {
        // 펼치기 - expandable 행들 보이기
        expandableRows.forEach(row => {
          row.classList.remove('hidden');
        });
        // 버튼 상태 업데이트
        if (toggleText) {
          toggleText.textContent = '접기';
        }
        if (toggleIcon) {
          toggleIcon.textContent = '▲';
        }
      }
    }
  </script>
</body>
</html>
